{% extends "base_statdev.html" %}

{% block page_content_inner %}
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-1"></div>
        <div class="col-lg-5">
            <h1>Application {{ object.pk }}</h1>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Applicant</h3>
                </div>
                <div class="panel-body">
                    <p>Applicant details here</p>
                </div>
            </div>


            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Application Details</h3>
                </div>
                <div class="panel-body">
                    <table class="table table-bordered table-striped">
                        <tr>
                            <th class="col-lg-3">Submitted:</th>
                            <td class="col-lg-3"> {{ object.submit_date|date:"d-M-Y" }}</td>
                        </tr>
                        <tr>
                            <th class="col-lg-3">Type:</th>
                            <td class="col-lg-3">{{ object.get_app_type_display }}</td>
                        </tr>
                        <tr>
                            <th class="col-lg-3">Title:</th>
                            <td class="col-lg-3">{{ object.title }}</td>
                        </tr>
                        <tr>
                            <th class="col-lg-3">Description:</th>
                            <td class="col-lg-3">{{ objeect.description }}</td> 
                        </tr>
                        <tr>
                            <th class="col-lg-3">Status:</th>
                            <td class="col-lg-3"> {{ object.state }}</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<h2>Referrals:</h2>
{% if object.referral_set.exists %}
<ul>
    {% for ref in object.referral_set.all %}
    <li>Referral {{ ref.pk }} to {{ ref.referee }}
        {% if may_refer %}<a href="">Remind</a> <a href="">Resend</a> <a href="">Recall</a>{% endif %}
        {% if ref.referee == user %}<a href="{% url 'condition_create' ref.application.pk %}">Create a condition</a> Finished{% endif %}
    </li>
    {% endfor %}
</ul>
{% else %}
<p>None</p>
{% endif %}

<h2>Conditions:</h2>
{% if object.condition_set.exists %}
<ul>
    {% for cond in object.condition_set.all %}
    <li>Condition {{ cond.pk }}: {{ cond.condition }} ({{ cond.get_status_display }}){% if cond.referral %} via {{ cond.referral.referee }}{% endif %}</li>
    {% endfor %}
</ul>
{% else %}
<p>None</p>
{% endif %}

{% comment %}
<h2>Tasks:</h2>
{% if object.task_set.exists %}
<ul>
    {% for task in object.task_set.all %}
    <li>Task {{ task.pk }} {{ task.get_task_type_display }} ({{ task.get_status_display }}) - assigned to {{ task.assignee }} <a href="{% url 'task_reassign' task.pk  %}">Reassign</a> <a href="">Complete</a></li>
    {% endfor %}
</ul>
{% else %}
<p>None</p>
{% endif %}
{% endcomment %}

<h2>Actions:</h2>
<ul>
    {# TODO: show greyed-out actions where they cannot be performed. #}
    <li>{% if may_update %}<a href="{% url 'application_update' object.pk %}">Update application</a>{% else %}Update application{% endif %}</li>
    <li>{% if may_lodge %}<a href="{% url 'application_lodge' object.pk %}">Lodge for assessment</a>{% else %}Lodge for assessment{% endif %}</li>
    <li>{% if may_refer %}<a href="{% url 'application_refer' object.pk %}">Refer for conditions</a>{% else %}Refer for conditions{% endif %}</li>
    {% if may_create_condition %}<li><a href="{% url 'condition_create' object.pk %}">Create new condition</a></li>{% endif %}
</ul>
{% endblock %}
