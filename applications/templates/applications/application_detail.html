{% extends "base_statdev.html" %}

{% block page_content_inner %}
<div class="container-fluid">
    <div class="row">
        <h1>Application for new {{ object.get_app_type_display }} - {{ object.pk }}</h1>
        <br />
    </div>
<!-- Action panel start -->
    <div class="row">
        <div class="col-lg-2">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Logs</h3>
                </div>
                <div class="panel-body">
                    <h5>Communications</h5>
                    <p><a href="#">Show</a> | <a href="#">Add Entry</a></p>
                    <hr />
                    <h5>Actions</h5>
                    <p><a href="#">Show</a></p>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Submission</h3>
                </div>
                <div class="panel-body">
                    <h5>Submitted by</h5>
                    <br />
                    <h5>Lodged on</h5>
                    <p>{{ object.submit_date|date:"d-M-Y" }}</p>
                    <br />
                    <h5>Logement  Date   Action</h5>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Workflow</h3>
                </div>
                <div class="panel-body">
                    <h5>Status</h5>
                    <p>{{ object.get_state_display }}</p>
                    <h5>Assigned to</h5>
                    {% if object.assignee %}
                        <p>{{ object.assignee.first_name }} {{ object.assignee.last_name }}</p>
                    {% else %}
                        <p>--</p>
                    {% endif %}
                </div>
            </div>
        </div>
<!-- Main panel start -->
        <div class="col-lg-5">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Applicant</h3>
                </div>
                <div class="panel-body">
                    <p>Applicant details here</p>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Title</h3>
                </div>
                <div class="panel-body">
                    <p>{{ object.title }}</p>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Proposed Commercial Acts and Activites</h3>
                </div>
                <div class="panel-body">
                    <p>{{ object.description }}</p>
                </div>
            </div>


            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Vessel and Craft Details</h3>
                </div>
                <div class="panel-body">
                    <table class="table table-bordered table-striped">
                        <tr>
                            <th class="col-lg-3">Submitted:</th>
                            <td class="col-lg-3"> {{ object.submit_date|date:"d-M-Y" }}</td>
                        </tr>
                        <tr>
                            <th class="col-lg-3">Type:</th>
                            <td class="col-lg-3">{{ object.get_app_type_display }}</td>
                        </tr>
                        <tr>
                            <th class="col-lg-3">Title:</th>
                            <td class="col-lg-3">{{ object.title }}</td>
                        </tr>
                        <tr>
                            <th class="col-lg-3">Description:</th>
                            <td class="col-lg-3">{{ object.description }}</td>
                        </tr>
                        <tr>
                            <th class="col-lg-3">Status:</th>
                            <td class="col-lg-3"> {{ object.get_state_display }}</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Proposal Details</h3>
                </div>
                <div class="panel-body">
                    <div class="fluid-container">
                        <div class="row">
                            <div class="col-lg-4">
                                <h5>Purpose of Approval</h5>
                                <p>{{ object.purpose }}</p>
                            </div>
                            <div class="col-lg-2"></div>
                        </div>
                        <div class="row">
                            <div class="col-lg-4">
                                <h5>Proposed Commencement Date</h5>
                                <p>{{ object.proposed_commence|date:"d-M-Y" }}</p>
                            </div>
                            <div class="col-lg-4">
                                <h5>Proposed End Date</h5>
                                <p>{{ object.proposed_end|date:"d-M-Y" }}</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-4">
                                <h5>Maximum Number of Participants</h5>
                                <p>{{ object.max_participants }}</p>
                            </div>
                            <div class="col-lg-4">
                                <h5>Proposed Location</h5>
                                <p>{{ object.proposed_location }}</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-8">
                                <h5>Address of any landbased component of the commercial activity</h5>
                                <p>{{ object.address }}</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-8">
                                <h5>Location / Route and Access points (mark clearly in map)</h5>
                                <p>{{ object.location_route_access }}</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-8">
                                <h5>List of jetties to be used</h5>
                                <p>{{ object.jetties }}</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6">
                                <h5>Do you have approval to use Department of Transport service jetties?</h5>
                            </div>
                            <div class="col-lg-2">
                                {% if object.jetty_dot_approval is True %}
                                
                                    <label class="radio-inline">
                                        <input type="radio" name="dotapproval" 
                                            checked="true" disabled="true">Yes
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="dotapproval" disabled="true">No
                                    </label>
                                {% else %}
                                    <label class="radio-inline">
                                        <input type="radio" name="dotapproval" disabled="true">Yes
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="dotapproval" 
                                            checked="true" disabled="true">No
                                    </label>
                                {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Other Documents</h3>
                </div>
                <div class="panel-body">
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Landowner Consent</h3>
                </div>
                <div class="panel-body">
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Deed</h3>
                </div>
                <div class="panel-body">
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Referrals</h3>
                </div>
                <div class="panel-body">
                    {% if object.referral_set.exists %}
                    <ul>
                        {% for ref in object.referral_set.all %}
                        <li>Referral {{ ref.pk }} to {{ ref.referee }}
                            {% if may_refer and not ref.response_date %}
                                <a href="">Remind</a> <a href="">Resend</a> <a href="">Recall</a>
                            {% endif %}
                            {% if ref.referee == user and not ref.response_date %}
                                <a href="{% url 'condition_create' ref.application.pk %}">Create a condition</a>
                                <a href="{% url 'referral_complete' ref.pk %}">Completed</a>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p>None</p>
                    {% endif %}
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Conditions</h3>
                </div>
                <div class="panel-body">
                    {% if object.condition_set.exists %}
                    <ul>
                        {% for cond in object.condition_set.all %}
                        <li>Condition {{ cond.pk }}: {{ cond.condition }} ({{ cond.get_status_display }})
                        {% if cond.referral %} via {{ cond.referral.referee }}{% endif %}</li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p>None</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

{% comment %}
<h2>Tasks:</h2>
{% if object.task_set.exists %}
<ul>
    {% for task in object.task_set.all %}
    <li>Task {{ task.pk }} {{ task.get_task_type_display }} ({{ task.get_status_display }}) - assigned to {{ task.assignee }} <a href="{% url 'task_reassign' task.pk  %}">Reassign</a> <a href="">Complete</a></li>
    {% endfor %}
</ul>
{% else %}
<p>None</p>
{% endif %}
{% endcomment %}

<h2>Actions:</h2>
<ul>
    {# TODO: show actions greyed-out where they cannot be performed. #}
    {% if may_update %}<li><a href="{% url 'application_update' object.pk %}">Update application</a></li>{% endif %}
    {% if may_lodge %}<li><a href="{% url 'application_lodge' object.pk %}">Lodge for assessment</a></li>{% endif %}
    {% if may_refer %}<li><a href="{% url 'application_refer' object.pk %}">Refer for conditions/feedback</a></li>{% endif %}
    {% if may_assign %}<li><a href="{% url 'application_assign' object.pk %}">Assign to an assessor</a></li>{% endif %}
    {% if may_create_condition %}<li><a href="{% url 'condition_create' object.pk %}">Create new condition</a></li>{% endif %}
    {% if may_submit_approval %}<li><a href="{% url 'application_approval' object.pk %}">Send for approval (assessment completed)</a></li>{% endif %}
    {% if may_issue %}<li><a href="{% url 'application_issue' object.pk %}">Issue/decline application to customer</a></li>{% endif %}
</ul>
{% endblock %}
